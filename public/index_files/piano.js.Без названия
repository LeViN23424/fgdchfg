(()=>{var i=e=>e.includes(".dev.")||e.includes(".stage.")?"dev":"prod",E=e=>e.split(".").slice(-2).join("."),C=(...e)=>{"dev"!==i(window.location.hostname)&&!window.location.search.includes("debug=true")||console.log("Piano Script: ",...e)};function O(e,t,r=""){e=document.getElementById(e);e?(C("sendPostMessageToPiano",{success:t,message:r}),e.contentWindow.postMessage({piano:{success:t,message:r}},"*")):console.error("Piano iframe is not found")}var e,t,o=n=>{C("customEvent",n.params);let{appendVxidToCtaUrl:t,ctaUrl:i,hasAutomatedPricing:r,hasCartAbandonment:a,onboardingUrl:e,params:s,registrationUrl:o,subscription:c,suppression:l,trackingCode:d}=n.params,p=cxenseOffers.getNewsletterId(i),u="true"!==c,m="Something went wrong. Please try again later.",w,g;try{w=JSON.parse(s)}catch{console.error("Piano Script iframeId is not valid")}let{iframeId:f="",trackingId:h="",url:b=window.location.href,templateId:v="",experienceId:y="",templateVariantId:x="",ctaType:P=""}=w||{},j={cx_P:cxenseOffers.getCxenseId(),pw_campaign:"PC_"+y,pw_widget:"PC_"+x,trackingId:h},k="";e&&(k=cxenseOffers.addQueryStringToUrl(e,{targetURL:b})),g=cxenseOffers.addQueryStringToUrl(i,{targetURL:k||b,...j}),C("customEvent",{eventName:n.eventName,ctaUrl:i,parsedParams:w,hasCartAbandonment:a,trackingCode:d});var I,U,_,S=()=>{var{desktopIframeHeight:e="1050px",mobileIframeHeight:t="1300px"}=n.params,r=document.getElementById(f);if(r){l&&cxdj.annotateUserProfile(l),utag.link({event_name:"subscribe_link",template_id:v});var a=r.src,e=(r.src=cxenseOffers.addQueryStringToUrl(i,j),r.parentElement.style.height=640<=window.innerWidth?e:t,r.style.height="100%",window.location.hostname),t=e.startsWith("jp")||e.startsWith("cn")?"wsj.com":cxdj.getTopDomain(e);{var r=t,e=f,s=a;let n=document.getElementById(e);if(n){let a=["https://caj-int.smpdev."+r,"https://caj-qa.smpdev."+r,"https://store."+r,"https://blue-store."+r,"https://store."+r];window.addEventListener("message",e=>{var t,{origin:e,data:r}=e;a.includes(e)&&({action:e,target:t}=r,C("getPostMessageFromIframe",{data:r,originIframeUrl:s}),"redirect"===e?window.location.href=t:"back"===e?n.src=s:"reload"===e&&(window.location.href=cxenseOffers.getClientRefreshUrl(window.location.href)))},!1)}else console.error("Piano iframe is not found")}}else console.error("Piano iframe is not found")};switch(n.eventName){case"register":_=cxenseOffers.getRegisterUrl(b,o),C("cxenseOffers.getRegisterUrl",_),window.location.href=_;break;case"sign-in":_=cxenseOffers.getLoginUrl(b),C("cxenseOffers.getLoginUrl",_),utag.link({event_name:"signin_link",template_id:v}),window.location.href=_;break;case"cta":(()=>{if("investors.com"===E(window.location.hostname))e=new CustomEvent("IBDPaywall_CTA_Clicked",{detail:{cta_type:P}}),window.dispatchEvent(e);else if(utag.link({event_name:"subscribe_link",template_id:v}),l&&cxdj.annotateUserProfile(l),"true"===t)window.location.href=cxenseOffers.addQueryStringToUrl(g,{vxid:cxenseOffers.getVxid()});else if("true"===r)window.location.href=cxdj.getAutomatedPricingUrl(g);else{if("true"===a){var e=cxenseOffers.getAbandonedCartData();if(e?.cartUrl)return window.location.href=cxenseOffers.addQueryStringToUrl(e.cartUrl,{inttrackingCode:d,...j})}window.location.href=g}})();break;case"snippet-in-situ-cta-click":case"iframe-loading":S();break;case"sub-newsletter-signup":C("customEvent",{newsletterId:p,isSubscribed:u}),p?cxenseOffers.handleNewsletterSignupForSub(p,u).then(e=>{if(!e.ok)throw new Error("Piano unable to sign up for newsletter for sub");O(f,!0),utag.link({event_name:"add_newsletter",newsletter_id:p,template_id:v})}).catch(()=>{O(f,!1,m)}):(utag.link({event_name:"subscribe_link",template_id:v}),window.location.href=g);break;case"non-sub-newsletter-signup":(()=>{C("customEvent newsletterId",p);var{email:e,marketing:t,consent:r}=n.params,t="true"===t,r=cxenseOffers.getNewsletterInputValidationMessage(e,"true"===r);r?O(f,!1,r):p?cxenseOffers.handleNewsletterSignupForNonSub(e,p,t,e=>{e?O(f,!1,m):(O(f,!0),utag.link({event_name:"add_newsletter",newsletter_id:p,template_id:v}))}):(utag.link({event_name:"subscribe_link",template_id:v}),window.location.href=g)})();break;case"article-cover-close":(U=document.querySelector("#cx-articlecover ~ section"))?U.style.opacity="1":console.error("Element articleBody is not found");break;case"social-sign-in":U=n.params.socialsign,I=encodeURIComponent(window.location.href),U=`https://${window.location.hostname}/client/social-login/${U}?target=`+I,window.location.href=U;break;case"job-form-submit":(()=>{var{jobTitle:e,jobIndustry:t,jobFunction:r}=n.params;e&&t&&r?cxenseOffers.submitJobForm({jobTitle:e,jobIndustry:t,jobFunction:r},e=>{e?O(f,!1,m):O(f,!0)}):O(f,!1,"Please select all fields")})()}},a=async()=>{try{if(window.entitlementsAsyncData)return await window.entitlementsAsyncData||{}}catch(e){return console.error("[Piano.js] Error fetching entitlements data: ",e?.message||"Unknown error"),{}}},c=async(t,r)=>{try{var e=await a();return t.split(".").reduce((e,t)=>e?.[t],e)||r}catch(e){return console.error(`Error fetching entitlements from ${t}:`,e),r}},l=()=>c("paywall.userProfile",{}),d=()=>c("paywall.experienceOutcome",{}),r=e=>{var t=document.querySelector(e);let r=document.querySelector(e+"-container");if(r&&t){r.style.minHeight="210px";let e=t.firstChild;e&&new ResizeObserver(()=>{r.style.height=.9*e.offsetHeight+"px"}).observe(e)}},p=(e,t)=>{if("modal"===t)cxenseOffers.adjustModal();else switch(e){case"#cx-header":cxenseOffers.adjustHeaderTile(e);break;case"#cx-articlecover":cxenseOffers.adjustArticleCover(e);break;case"#cx-snippet-overlay":r(e)}},u=e=>{var{containerSelector:e,displayMode:t}=e;p(e,t)},n=(e,t="name")=>e&&document.querySelector(`meta[${t}="${e}"]`)||null,m=(e,t)=>n(e,t)?.getAttribute("content")||"",w=()=>{var e=(m("keywords","name")||"").split(",").map(e=>e.trim()).filter(e=>e).map(e=>e.replace(/\s+/g," ").replace(/\//g,"-").toLowerCase());let r=[...["cXenseParse:wsj-articletype","cXenseParse:wsj-editorial-keyword","cXenseParse:wsj-author","cXenseParse:wsj-taxonomy-l1","cXenseParse:wsj-taxonomy-l2","cXenseParse:wsj-categories","cXenseParse:wsj-commenting"].map(e=>{var t=n(e);if(!t)return null;var r=t.getAttribute("content");if(!r)return null;let a=e.replace("cXenseParse:wsj-","");e=t.getAttribute("data-separator");return e?r.split(e).map(e=>a+":"+e.trim()):[a+":"+r]}).filter(Boolean).flat(),...e];["page.content.type","page.site.product","page.content.source"].forEach(e=>{var t=m(e);t&&r.push((e.replace(/.*\./,"")+":"+t).toLowerCase())});e=m("cXenseParse:wsj-pageregion")||m("page.region");return e&&r.push(("pageregion:"+e).replace(",","|")),r};(async()=>{tp=window.tp||[];var e=window.location.hostname,t=E(e);tp.push(["setAid",(a=i(n=e),n=E(n),{dev:{"barrons.com":"bcO5aY6Spu","fnlondon.com":"z2oh4s6Gpu","investors.com":"b2rLJCJEpu","marketwatch.com":"jR7wUxSLpu","mansionglobal.com":"VYWZ4EwJpu","penews.com":"R2fXvVcdpu","wsj.com":"Rp5auWUipu"},prod:{"barrons.com":"ETbHfCPwpu","fnlondon.com":"P8w476pvpu","investors.com":"fxh8PtEJpu","mansionglobal.com":"CdP0jvz0pu","marketwatch.com":"6ykQ27IEpu","penews.com":"gMFCR4aEpu","wsj.com":"KKbgqpBlpu"}}[a][n]||"")]),tp.push(["setCxenseSiteId",cxdj.getSiteId(e)]),tp.push(["setComposerHost","https://piano.c2."+t]),tp.push(["setPianoIdUrl","https://piano.auth."+t]),tp.push(["setEndpoint","https://piano.vx."+t]),tp.push(["setStaticDomain","https://piano.cdn."+t]),tp.push(["setUseTinypassAccounts",!1]),tp.push(["setUsePianoIdUserProvider",!1]),tp.push(["setUsePianoIdLiteUserProvider",!0]),tp.push(["setExternalJWT",await c("client.piano.jwt","")]),tp.push(["setTags",w()]),tp.push(["setContentSection",m("cXenseParse:wsj-articlesection")||""]);let r=e=>{for(var[t,r]of Object.entries(e))tp.push(["setCustomVariable",t,r])};var a=async t=>{try{var e=await t();r(e)}catch(e){console.error(t.name+" error",e)}},n=window.utag_data?.user_type||await c("type",""),{cartAbandonment:e,articleHeadline:t,pageSection:s}=(()=>{var{article_headline:e,page_section:t}=cxdj.getUtagData(),e={articleHeadline:e,pageSection:t};return cxenseOffers.getAbandonedCartData()?.cartUrl&&(e.cartAbandonment=!0),e})(),t={ab_bucket:cxdj.getAbBucket(),articleHeadline:t,bucket:cxdj.getUserBucket(),cartAbandonment:e,cx_p:cxenseOffers.getCxenseId(),newsletterIds:await(async e=>{e=cxdj.normalizeUserType(e);if(!["subscriber","prosubscriber","registered"].includes(e))return[];try{var t=await fetch("/newsletters/svc/signup/2",{method:"GET",credentials:"include",headers:{"content-type":"application/json; charset=UTF-8"},mode:"cors"});if(!t.ok)throw new Error("Invalid HTTP Status Code");var r=await t.json();if(r?.subscriptions)return r.subscriptions.filter(e=>e?.opt_in).map(e=>e.id);throw new Error("Invalid User Subscriptions Data")}catch(e){return console.error("Error retrieving newsletter IDs",e),[]}})(n),pageSection:s,propensity_bucket:await(async()=>{var t=(await c("profiles.propensity",{})).propensityScore;if(!(isNaN(t)||t<0||1<t)){let e;return e=Math.round(10*t)===10*t?t?10*t:1:Math.ceil(10*t)}})(),subscriber:cxdj.normalizeUserType(n),subPaused:await c("pausedSub",!1),userTags:await c("tags",[]),vxid:cxenseOffers.getVxid()};r(t),await a(l),await a(d),await a(cxdj.getAutomatedPricingData),tp.push(["addHandler","customEvent",o]),tp.push(["addHandler","showTemplate",u]),tp.push(["init",function(){tp.experience.init(),C("custom variables: ",tp.customVariables);t=window.location.href,t=new URL(t).search,t=new URLSearchParams(t),r=t.get("divId");var e=(e=t.get("experienceId"))?{experience_id:e}:{templateId:t.get("templateId"),templateVariantId:t.get("variantId"),containerSelector:r?"#"+r:null,displayMode:"inline"},{templateId:t,containerSelector:r}=(C("getPianoParams: ",e),e),a=document.querySelector(r);t&&(a?(tp.template.show(e),p(r,e.displayMode),console.log("Piano Script show template based on url params")):console.error("Piano Script divId is not found"))}])})(),(e=document.createElement("script")).type="text/javascript",e.async=!0,e.src="https://cdn.tinypass.com/api/tinypass.min.js",(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t)})();